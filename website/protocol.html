<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protocol - MumbleChat Native Decentralized Messaging</title>
    <meta name="description" content="Learn how MumbleChat Protocol works: X25519 encryption, on-chain identity, P2P relay network, and message delivery.">
    
    <link rel="icon" type="image/svg+xml" href="icons/icon.svg">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32.png">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="MumbleChat">
    <link rel="apple-touch-icon" href="icons/icon-192.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="logo">
                <div class="logo-icon">ğŸ’¬</div>
                <span>MumbleChat</span>
            </a>
            
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="protocol.html" class="active">Protocol</a></li>
                <li><a href="token.html">MCT Token</a></li>
                <li class="nav-dropdown">
                    <a>ğŸŒ Network</a>
                    <div class="dropdown-menu">
                        <a href="relay-nodes.html">ğŸ“‹ Relay Nodes</a>
                        <a href="network-status.html">ğŸ“¡ Network Status</a>
                        <div class="dropdown-divider"></div>
                        <a href="relay-node.html" style="color: #4bc0c8;">ğŸš€ Run a Node</a>
                    </div>
                </li>
                <li><a href="download.html">Download</a></li>
                <li><a href="docs.html">Docs</a></li>
            </ul>
            
            <div class="nav-actions">
                <a href="conversations.html" class="btn btn-primary">Chat Now</a>
                <button class="mobile-menu-btn">â˜°</button>
            </div>
        </div>
    </nav>

    <!-- Hero -->
    <section class="hero" style="min-height: 60vh;">
        <div class="hero-content">
            <div class="hero-badge">
                <span>ğŸ“–</span>
                <span>Protocol V4.0 - Split Architecture Live</span>
            </div>
            <h1 class="hero-title">How <span>MumbleChat Protocol</span> Works</h1>
            <p class="hero-subtitle">
                Native decentralized messaging on Ramestta. V4 Split Architecture: Registry (Identity) + 
                RelayManager (Nodes). Kademlia DHT, STUN/UDP hole punching, X25519+AES-256-GCM encryption.
            </p>
        </div>
    </section>

    <!-- Architecture Overview -->
    <section class="section" id="architecture">
        <div class="container">
            <div class="section-title">
                <h2>Protocol <span>Architecture</span></h2>
            </div>
            
            <div class="card mb-4">
                <pre class="code-block"><code>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   MUMBLECHAT PROTOCOL V4.0 STACK                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚   RamaPay   â”‚     â”‚   Chrome    â”‚     â”‚   Desktop   â”‚   CLIENTS    â”‚
â”‚   â”‚   Android   â”‚     â”‚  Extension  â”‚     â”‚ Relay Node  â”‚               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚          â”‚                   â”‚                   â”‚                       â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                              â–¼                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚                    MumbleChat Core Layer                      â”‚      â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚      â”‚
â”‚   â”‚  â”‚  Crypto    â”‚  â”‚ MessageCodecâ”‚ â”‚ ChatServiceâ”‚              â”‚      â”‚
â”‚   â”‚  â”‚X25519+GCM  â”‚  â”‚ Binary Wire â”‚  â”‚ Orchestratorâ”‚            â”‚      â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                              â”‚                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚                    P2P Transport Layer                        â”‚      â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚      â”‚
â”‚   â”‚  â”‚ KademliaDHTâ”‚  â”‚ STUN/NAT   â”‚  â”‚ Rate       â”‚  SECURITY   â”‚      â”‚
â”‚   â”‚  â”‚ +Sybil Res.â”‚  â”‚ Traversal  â”‚  â”‚ Limiter    â”‚              â”‚      â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                              â”‚                                           â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚          â–¼                   â–¼                   â–¼                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚ UDP Direct  â”‚     â”‚   Relay     â”‚     â”‚  Ramestta   â”‚   NETWORK    â”‚
â”‚   â”‚ (Hole Punch)â”‚â—„â”€â”€â”€â–ºâ”‚   Nodes     â”‚â—„â”€â”€â”€â–ºâ”‚  Blockchain â”‚               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚              V4 SMART CONTRACT ARCHITECTURE                    â”‚      â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚      â”‚
â”‚   â”‚  â”‚    MCTToken     â”‚  â”‚  Registry V4    â”‚  â”‚ RelayManager â”‚  â”‚      â”‚
â”‚   â”‚  â”‚   (ERC-20)      â”‚  â”‚  (Identity)     â”‚  â”‚   (Nodes)    â”‚  â”‚      â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                </code></pre>
            </div>
        </div>
    </section>

    <!-- Identity Section -->
    <section class="section" id="identity" style="background: var(--bg-card);">
        <div class="container">
            <div class="section-title">
                <h2>ğŸ”‘ On-Chain <span>Identity</span></h2>
                <p class="section-subtitle">
                    Your wallet address is your identity. Public keys stored immutably on blockchain.
                </p>
            </div>
            
            <div class="grid grid-2">
                <div class="card">
                    <h3 class="card-title">Registration Flow</h3>
                    <pre class="code-block"><code><span class="comment">// 1. Generate X25519 keypair on device</span>
<span class="keyword">val</span> keyPair = X25519.generateKeyPair()

<span class="comment">// 2. Store public key on-chain</span>
registry.register(
    publicKeyX: keyPair.publicKey,
    displayName: <span class="string">"alice.rama"</span>
)

<span class="comment">// 3. Identity now discoverable</span>
<span class="comment">// Anyone can lookup your public key by wallet address</span>
                    </code></pre>
                </div>
                
                <div class="card">
                    <h3 class="card-title">Identity Struct (Solidity)</h3>
                    <pre class="code-block"><code><span class="keyword">struct</span> Identity {
    bytes32 publicKeyX;      <span class="comment">// X25519 public key</span>
    bytes32 publicKeyY;      <span class="comment">// Reserved</span>
    uint256 registeredAt;    <span class="comment">// Timestamp</span>
    uint256 lastUpdated;     <span class="comment">// Key rotation</span>
    bool isActive;           <span class="comment">// Active status</span>
    string displayName;      <span class="comment">// Optional name</span>
}
                    </code></pre>
                </div>
            </div>
            
            <div class="card mt-4">
                <h3 class="card-title">Key Features</h3>
                <div class="grid grid-3 mt-3">
                    <div>
                        <h4>ğŸ” Self-Sovereign</h4>
                        <p class="card-text">You own your identity. No platform can ban or censor you.</p>
                    </div>
                    <div>
                        <h4>ğŸ”„ Key Rotation</h4>
                        <p class="card-text">Update your public key anytime via updatePublicKey().</p>
                    </div>
                    <div>
                        <h4>ğŸ” Discoverable</h4>
                        <p class="card-text">Anyone can lookup your public key by wallet address.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Encryption Section -->
    <section class="section" id="encryption">
        <div class="container">
            <div class="section-title">
                <h2>ğŸ” End-to-End <span>Encryption</span></h2>
                <p class="section-subtitle">
                    X25519 ECDH key exchange + AES-256-GCM encryption. Military-grade security.
                </p>
            </div>
            
            <div class="card mb-4">
                <h3 class="card-title">Encryption Flow</h3>
                <pre class="code-block"><code>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ENCRYPTION PROCESS                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  SENDER (Alice)                              RECIPIENT (Bob)            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€             â”‚
â”‚                                                                          â”‚
â”‚  1. Lookup Bob's public key from blockchain                             â”‚
â”‚     bobPubKey = registry.getPublicKey(bobAddress)                       â”‚
â”‚                                                                          â”‚
â”‚  2. Generate ephemeral keypair                                          â”‚
â”‚     ephemeralKey = X25519.generateKeyPair()                             â”‚
â”‚                                                                          â”‚
â”‚  3. Derive shared secret (ECDH)                                         â”‚
â”‚     sharedSecret = X25519.agree(ephemeralKey.private, bobPubKey)        â”‚
â”‚                                                                          â”‚
â”‚  4. Derive AES key using HKDF                                           â”‚
â”‚     aesKey = HKDF(sharedSecret, salt, info)                             â”‚
â”‚                                                                          â”‚
â”‚  5. Encrypt message with AES-256-GCM                                    â”‚
â”‚     ciphertext = AES_GCM.encrypt(aesKey, nonce, plaintext)              â”‚
â”‚                                                                          â”‚
â”‚  6. Package: [ephemeralPubKey | nonce | ciphertext | authTag]           â”‚
â”‚                                                                          â”‚
â”‚  7. Send to relay node or directly to Bob                               â”‚
â”‚                                                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                          â”‚
â”‚  Bob receives and:                                                       â”‚
â”‚  1. Uses his private key + ephemeral public key to derive same secret   â”‚
â”‚  2. Decrypts message with AES-256-GCM                                   â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                </code></pre>
            </div>
            
            <div class="grid grid-3">
                <div class="card">
                    <div class="card-icon">ğŸ”‘</div>
                    <h3 class="card-title">X25519 ECDH</h3>
                    <p class="card-text">
                        Elliptic-curve Diffie-Hellman for secure key exchange. 
                        Each message uses a unique ephemeral key for forward secrecy.
                    </p>
                </div>
                
                <div class="card">
                    <div class="card-icon">ğŸ›¡ï¸</div>
                    <h3 class="card-title">AES-256-GCM</h3>
                    <p class="card-text">
                        Authenticated encryption with 256-bit key. 
                        Provides confidentiality AND integrity verification.
                    </p>
                </div>
                
                <div class="card">
                    <div class="card-icon">ğŸ”’</div>
                    <h3 class="card-title">Forward Secrecy</h3>
                    <p class="card-text">
                        Ephemeral keys ensure past messages stay secure 
                        even if long-term keys are compromised.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Messaging Section -->
    <section class="section" id="messaging" style="background: var(--bg-card);">
        <div class="container">
            <div class="section-title">
                <h2>ğŸ“¨ Message <span>Protocol</span></h2>
                <p class="section-subtitle">
                    How messages are structured, routed, and delivered in the MumbleChat network.
                </p>
            </div>
            
            <div class="card mb-4">
                <h3 class="card-title">Message Structure</h3>
                <pre class="code-block"><code><span class="keyword">data class</span> MumbleChatMessage(
    <span class="keyword">val</span> version: Int = <span class="number">1</span>,                    <span class="comment">// Protocol version</span>
    <span class="keyword">val</span> type: MessageType,                   <span class="comment">// TEXT, FILE, PAYMENT</span>
    <span class="keyword">val</span> senderKeyHash: ByteArray,            <span class="comment">// keccak256(sender)[:8]</span>
    <span class="keyword">val</span> recipientKeyHash: ByteArray,         <span class="comment">// keccak256(recipient)[:8]</span>
    <span class="keyword">val</span> ephemeralPubKey: ByteArray,          <span class="comment">// 32 bytes</span>
    <span class="keyword">val</span> nonce: ByteArray,                    <span class="comment">// 12 bytes</span>
    <span class="keyword">val</span> ciphertext: ByteArray,               <span class="comment">// Encrypted content</span>
    <span class="keyword">val</span> authTag: ByteArray,                  <span class="comment">// 16 bytes</span>
    <span class="keyword">val</span> timestamp: Long,                     <span class="comment">// Unix millis</span>
    <span class="keyword">val</span> signature: ByteArray                 <span class="comment">// ECDSA signature</span>
)
                </code></pre>
            </div>
            
            <div class="grid grid-2">
                <div class="card">
                    <h3 class="card-title">Direct Delivery (P2P)</h3>
                    <p class="card-text mb-3">When recipient is online, messages go directly peer-to-peer.</p>
                    <pre class="code-block"><code><span class="comment">// 1. Discover peer via DHT</span>
peerInfo = dht.findPeer(recipientAddress)

<span class="comment">// 2. Establish libp2p connection</span>
conn = network.dial(peerInfo.multiaddr)

<span class="comment">// 3. Send encrypted message</span>
conn.send(encryptedMessage)

<span class="comment">// 4. Receive ACK</span>
ack = conn.receive()
                    </code></pre>
                </div>
                
                <div class="card">
                    <h3 class="card-title">Relay Delivery (Offline)</h3>
                    <p class="card-text mb-3">When recipient is offline, relay nodes store messages.</p>
                    <pre class="code-block"><code><span class="comment">// 1. Peer not found online</span>
<span class="keyword">if</span> (dht.findPeer(recipient) == <span class="keyword">null</span>) {

    <span class="comment">// 2. Find relay nodes for recipient</span>
    relays = dht.findRelays(recipientKeyHash)
    
    <span class="comment">// 3. Send to multiple relays</span>
    relays.forEach { relay ->
        relay.store(encryptedMessage, ttl = 7.days)
    }
}
                    </code></pre>
                </div>
            </div>
        </div>
    </section>

    <!-- Relay Network Section -->
    <section class="section" id="relay">
        <div class="container">
            <div class="section-title">
                <h2>ğŸŒ Relay <span>Network</span></h2>
                <p class="section-subtitle">
                    Decentralized nodes that store encrypted messages for offline users and earn MCT rewards.
                </p>
            </div>
            
            <div class="card mb-4">
                <pre class="code-block"><code>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     RELAY NODE ARCHITECTURE                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   SENDER                  RELAY NETWORK                   RECIPIENT     â”‚
â”‚   â”€â”€â”€â”€â”€â”€                  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚                                                                          â”‚
â”‚   [Alice] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚      â”‚    Encrypted       â”‚   Relay A   â”‚  Store for Bob                â”‚
â”‚      â”‚    Message         â”‚  (Gold Tier)â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  [Bob]        â”‚
â”‚      â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚         (offline)     â”‚
â”‚      â”‚                                          â”‚                        â”‚
â”‚      â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚                        â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚   Relay B   â”‚       â”‚                        â”‚
â”‚           Redundancy      â”‚(Silver Tier)â”‚â—„â”€â”€â”€â”€â”€â”€â”˜         [Bob]         â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 (online)      â”‚
â”‚                                  â”‚                           â–²          â”‚
â”‚                                  â”‚      Deliver when         â”‚          â”‚
â”‚                                  â””â”€â”€â”€â”€â”€â”€â”€Bob onlineâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                          â”‚
â”‚   RELAY STORAGE:                                                        â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                       â”‚
â”‚   â€¢ recipientKeyHash: First 8 bytes of keccak256(address)               â”‚
â”‚   â€¢ encryptedBlob: Opaque to relay (can't read content)                 â”‚
â”‚   â€¢ expiresAt: TTL (default 7 days)                                     â”‚
â”‚   â€¢ size: For storage tracking                                          â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                </code></pre>
            </div>
            
            <div class="text-center mt-4">
                <a href="relay-nodes.html" class="btn btn-primary btn-lg">
                    Learn More About Relay Nodes â†’
                </a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-brand">
                    <a href="index.html" class="logo">
                        <div class="logo-icon">ğŸ’¬</div>
                        <span>MumbleChat</span>
                    </a>
                    <p>Native decentralized messaging protocol on Ramestta blockchain.</p>
                </div>
                
                <div>
                    <h4 class="footer-title">Protocol</h4>
                    <ul class="footer-links">
                        <li><a href="protocol.html">How It Works</a></li>
                        <li><a href="protocol.html#encryption">Encryption</a></li>
                        <li><a href="protocol.html#identity">Identity</a></li>
                        <li><a href="protocol.html#messaging">Messaging</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="footer-title">Token</h4>
                    <ul class="footer-links">
                        <li><a href="token.html">MCT Tokenomics</a></li>
                        <li><a href="token.html#halving">Halving</a></li>
                        <li><a href="token.html#rewards">Rewards</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="footer-title">Resources</h4>
                    <ul class="footer-links">
                        <li><a href="download.html">Download</a></li>
                        <li><a href="docs.html">Documentation</a></li>
                        <li><a href="https://ramascan.com" target="_blank">RamaScan</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <span>Â© 2026 MumbleChat Protocol. Built on Ramestta.</span>
            </div>
        </div>
    </footer>
    
    <!-- Bottom Navigation for Mobile -->
    <nav class="bottom-nav">
        <div class="bottom-nav-container">
            <a href="index.html" class="bottom-nav-item">
                <span class="bottom-nav-icon">ğŸ </span>
                <span class="bottom-nav-label">Home</span>
            </a>
            <div class="bottom-nav-item bottom-nav-dropdown" onclick="toggleNetworkMenu(this)">
                <span class="bottom-nav-icon">ğŸ“¡</span>
                <span class="bottom-nav-label">Network</span>
                <div class="bottom-nav-menu">
                    <a href="relay-nodes.html">ğŸ“‹ Relay Nodes</a>
                    <a href="network-status.html">ğŸ“¡ Network Status</a>
                    <div class="divider"></div>
                    <a href="relay-node.html" style="color: #4bc0c8;">ğŸš€ Run a Node</a>
                </div>
            </div>
            <a href="conversations.html" class="bottom-nav-item">
                <span class="bottom-nav-icon">ğŸ’¬</span>
                <span class="bottom-nav-label">Chat</span>
            </a>
            <a href="token.html" class="bottom-nav-item">
                <span class="bottom-nav-icon">ğŸª™</span>
                <span class="bottom-nav-label">Token</span>
            </a>
            <a href="docs.html" class="bottom-nav-item">
                <span class="bottom-nav-icon">ğŸ“š</span>
                <span class="bottom-nav-label">Docs</span>
            </a>
        </div>
    </nav>
    
    <script>
        function toggleNetworkMenu(el) {
            el.classList.toggle('open');
        }
        document.addEventListener('click', function(e) {
            // Close menu when clicking a link inside it
            if (e.target.closest('.bottom-nav-menu a')) {
                document.querySelectorAll('.bottom-nav-dropdown').forEach(d => d.classList.remove('open'));
                return;
            }
            if (!e.target.closest('.bottom-nav-dropdown')) {
                document.querySelectorAll('.bottom-nav-dropdown').forEach(d => d.classList.remove('open'));
            }
        });
    </script>
    <script src="js/app.js"></script>
</body>
</html>
